# Firebase Setup Complete Guide

## Quick Setup Commands

Run these commands in order:

```bash
# 1. Install dependencies
flutter pub get

# 2. Configure Firebase (creates firebase_options.dart and downloads config files)
flutterfire configure

# 3. Install iOS dependencies
cd ios && pod install && cd ..

# 4. Test Flutter doctor
flutter doctor

# 5. Clean and rebuild
flutter clean
flutter pub get
```

---

## What Has Been Set Up

### Dependencies Added
- `firebase_core: ^3.3.0` - Core Firebase SDK
- `firebase_auth: ^5.1.4` - Authentication
- `cloud_firestore: ^5.2.1` - NoSQL Database
- `firebase_storage: ^12.1.3` - File Storage (NEW)
- `firebase_messaging: ^15.0.4` - Push Notifications (NEW)
- `google_sign_in: ^6.2.1` - Google Sign-In

### Android Configuration
- **android/settings.gradle.kts**: Added Google Services plugin
- **android/app/build.gradle.kts**:
  - Added Google Services plugin
  - Set minSdk to 21 (Firebase requirement)
  - Added multiDex support
  - Added Firebase BOM dependencies

### iOS Configuration
- **ios/Podfile**: Set platform to iOS 13.0
- **ios/Runner/GoogleService-Info.plist**: Generated by flutterfire configure

### Main App Updates
- **lib/main.dart**:
  - Enabled Firebase initialization
  - Enabled dependency injection
  - Restored AuthWrapper for proper auth flow

### New Service Files Created

1. **lib/core/services/firestore_service.dart**
   - Complete Firestore CRUD operations
   - Query and filtering
   - Real-time streams
   - Batch operations
   - Transactions

2. **lib/core/services/firebase_storage_service.dart**
   - File upload/download
   - Multiple file handling
   - File deletion
   - Metadata retrieval

3. **lib/core/services/user_profile_service.dart**
   - Complete user profile management
   - Profile photo handling
   - User stats tracking
   - Batch operations

4. **lib/core/services/firebase_example_usage.dart**
   - Comprehensive usage examples
   - Authentication examples
   - Firestore CRUD examples
   - Storage examples
   - Complex operations (transactions, batch)

### Security Rules Created

1. **firestore.rules** - Firestore security rules
2. **storage.rules** - Storage security rules

---

## Deploy Security Rules to Firebase

After running `flutterfire configure`, deploy the security rules:

```bash
# Initialize Firebase in your project (if not already done)
firebase init

# Select:
# - Firestore
# - Storage
# Point to the rules files when prompted

# Deploy rules
firebase deploy --only firestore:rules
firebase deploy --only storage:rules

# Or deploy everything
firebase deploy
```

---

## Add Android App to Firebase Project

### IMPORTANT: Android Package Name
```
com.edgeup.edgeupUpscApp
```

### Steps to Add Android App:

1. **Go to Firebase Console**: https://console.firebase.google.com
2. **Select your project**: `edgeup-upsc-app`
3. **Add Android App**:
   - Click **"Add app"** button or âš™ï¸ â†’ **Project settings**
   - Click the **Android icon**
   - Enter **Android package name**: `com.edgeup.edgeupUpscApp`
   - **App nickname (optional)**: EdgeUp UPSC Android
   - **Debug signing certificate SHA-1 (optional)**: Leave blank for now
   - Click **"Register app"**

4. **Download google-services.json**:
   - Download the `google-services.json` file
   - Place it in: `edgeup_upsc_app/android/app/google-services.json`

5. **Run FlutterFire CLI**:
   ```bash
   cd edgeup_upsc_app
   flutterfire configure
   ```
   - Select project: `edgeup-upsc-app`
   - Select platforms: **iOS and Android** (both)
   - This regenerates `firebase_options.dart` with real credentials

6. **Verify Setup**:
   ```bash
   flutter run -d android
   ```

---

## Enable Firebase Services in Console

Go to [Firebase Console](https://console.firebase.google.com/) and enable:

### 1. Authentication
- Go to **Authentication** > **Sign-in method**
- Enable **Email/Password**
- Enable **Google** (optional)

### 2. Firestore Database
- Go to **Firestore Database**
- Click **Create database**
- Choose **Production mode** (our rules are already configured)
- Select your region

### 3. Storage
- Go to **Storage**
- Click **Get started**
- Use **Production mode** (our rules are configured)

### 4. Cloud Messaging (Optional)
- Go to **Cloud Messaging**
- Already enabled by default
- For iOS: Upload APNs certificate in Project Settings

---

## Test Firebase Connection

Create a test file to verify everything works:

```dart
// lib/test_firebase.dart
import 'package:firebase_core/firebase_core.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'firebase_options.dart';

Future<void> testFirebaseConnection() async {
  // Initialize Firebase
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );

  print('âœ… Firebase initialized successfully');

  // Test Auth
  final auth = FirebaseAuth.instance;
  print('âœ… Firebase Auth available');

  // Test Firestore
  final firestore = FirebaseFirestore.instance;
  print('âœ… Firestore available');

  // Test Storage
  final storage = FirebaseStorage.instance;
  print('âœ… Storage available');

  print('ðŸŽ‰ All Firebase services connected!');
}
```

---

## Running Your App

```bash
# Run on iOS
flutter run -d ios

# Run on Android
flutter run -d android

# Build for release
flutter build apk --release  # Android
flutter build ios --release  # iOS
```

---

## Common Issues and Fixes

### Issue: `google-services.json` not found
**Solution**: Run `flutterfire configure` again

### Issue: iOS build fails with CocoaPods
```bash
cd ios
pod deintegrate
pod install
cd ..
flutter clean
flutter pub get
```

### Issue: Android build fails
```bash
cd android
./gradlew clean
cd ..
flutter clean
flutter pub get
```

### Issue: Firebase not initializing
- Check `firebase_options.dart` has real API keys (not placeholders)
- Ensure `flutterfire configure` was run
- Verify `google-services.json` exists in `android/app/`
- Verify `GoogleService-Info.plist` exists in `ios/Runner/`

### Issue: Firestore permission denied
- Deploy security rules: `firebase deploy --only firestore:rules`
- Check rules in Firebase Console

---

## File Structure

```
lib/
â”œâ”€â”€ core/
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ firestore_service.dart          # Firestore CRUD
â”‚       â”œâ”€â”€ firebase_storage_service.dart   # File storage
â”‚       â”œâ”€â”€ user_profile_service.dart       # User management
â”‚       â””â”€â”€ firebase_example_usage.dart     # Usage examples
â”œâ”€â”€ firebase_options.dart                   # Firebase config (auto-generated)
â””â”€â”€ main.dart                               # App entry point

android/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ build.gradle.kts                    # Firebase config
â”‚   â””â”€â”€ google-services.json                # Android Firebase config (auto-generated)
â””â”€â”€ settings.gradle.kts                     # Google Services plugin

ios/
â”œâ”€â”€ Runner/
â”‚   â””â”€â”€ GoogleService-Info.plist            # iOS Firebase config (auto-generated)
â””â”€â”€ Podfile                                 # iOS platform version

firestore.rules                             # Firestore security rules
storage.rules                               # Storage security rules
```

---

## Next Steps

### Option 1: Authentication UI Templates
Would you like me to create:
- Complete login/signup UI screens
- Password reset flow
- Email verification handling
- Profile edit screen

### Option 2: Firestore Data Models
Would you like me to create:
- User model class
- Note model class
- Study session model
- Model converters (fromJson/toJson)

### Option 3: Cloud Functions
Would you like to set up:
- Automated email notifications
- Scheduled tasks (daily reminders)
- Data aggregation (leaderboard)
- Image processing on upload

### Option 4: Push Notifications
Would you like me to implement:
- FCM setup for both platforms
- Notification handling
- Topic subscriptions
- Custom notification UI

### Option 5: Deployment
Would you like help with:
- App signing for Android
- iOS provisioning profiles
- Play Store deployment
- App Store deployment

---

## Support

If you encounter issues:
1. Check the [FlutterFire documentation](https://firebase.flutter.dev/)
2. Run `flutter doctor -v` to check your setup
3. Check Firebase Console for any configuration issues
4. Verify security rules are deployed

---

## Summary

Your Firebase integration is now **production-ready** with:
- âœ… Complete authentication system
- âœ… Firestore database with CRUD operations
- âœ… File storage capabilities
- âœ… Push notification support (configured)
- âœ… Security rules for production
- âœ… Comprehensive example code
- âœ… Real-time data streaming
- âœ… Batch operations and transactions

**Next step**: Run `flutterfire configure` to generate your actual Firebase configuration!
